# Тема: Использование нотации C4 model для проектирования архитектуры программной системы
# Цель работы: Получить опыт использования графической нотации для фиксации архитектурных решений.

# Диаграмма системного контекста

<img width="477" height="699" alt="image" src="https://github.com/user-attachments/assets/2ad774f5-ec02-43cf-98d1-56c639d30c02" />
CRM Система: Центральный узел, который подвергается рефакторингу. Границы системы очерчены функционалом управления клиентами, задачами и финансами.

Пользователи: Менеджер (операционная деятельность) и Руководитель (аналитическая деятельность).
Внешние системы:
Почтовый сервис: Необходим для уведомлений о задачах или счетах.
Платежный шлюз: Упомянут в контексте финансовых операций (счета, история платежей).

# Диаграмма контейнеров

<img width="897" height="1248" alt="image" src="https://github.com/user-attachments/assets/7dfb5e74-c897-4415-85e5-07c252ac5787" />

Описание основных элементов
API Server: Монолитное ядро системы. Обрабатывает бизнес-логику, напрямую взаимодействует с базой данных и отправляет E-mail рассылки через SMTP.
Notification Service: Выделенный сервис для работы с WebSocket. Обеспечивает мгновенные Push-уведомления пользователям, разгружая основной API от поддержки постоянных соединений.
Apache Kafka: Обеспечивает асинхронную передачу событий между API и сервисом уведомлений.
Redis: Используется как быстрый кэш для запросов чтения (реализация CQS).
PostgreSQL: Основное реляционное хранилище данных.

Выбрана структура с выделенным сервисом уведомлений, чтобы разделить нагрузку. API занимается тяжелыми транзакциями и почтой, а Notification Service держит тысячи легковесных WebSocket-соединений с клиентами.

# Диаграмма компонентов

<img width="1253" height="1603" alt="image" src="https://github.com/user-attachments/assets/b12f5b28-b01c-45dc-b622-5289fb5d6011" />
Описание диаграммы компонентов API Сервера
Точкой входа в приложение является Слой представления (API Controllers), который принимает REST-запросы от клиентов и выполняет первичную валидацию данных. Взаимодействие с бизнес-логикой происходит через Медиатор, который маршрутизирует вызовы к нужным обработчикам, обеспечивая слабую связность компонентов и скрывая детали реализации от контроллеров.
Слой приложения (Application Layer) реализует бизнес-сценарии, следуя принципу разделения ответственности (CQS). Обработчики команд (Command Handlers) управляют изменением состояния системы и координируют работу доменных объектов, в то время как обработчики запросов (Query Handlers) отвечают за быстрое чтение данных и формирование DTO. В этом же слое определены абстрактные интерфейсы для работы с внешними ресурсам, что обеспечивает инверсию зависимостей.
Центральным элементом архитектуры выступает Доменный слой (Domain Layer), содержащий чистую бизнес-логику, не зависящую от баз данных и фреймворков. Здесь находятся основные сущности (Клиент, Задача) и сущность Встречи, так как функционал календаря реализован внутри системы. Сложные правила, такие как проверка пересечения встреч в расписании, инкапсулированы в Доменных сервисах.
Техническая реализация взаимодействия с внешним миром вынесена в Слой инфраструктуры. Он включает в себя репозитории для доступа к базе данных через EF Core, реализацию сервиса для прямой отправки электронной почты по протоколу SMTP, а также компоненты для публикации событий в Kafka, необходимые для работы системы Push-уведомлений.
