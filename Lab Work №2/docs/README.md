# Тема: Использование нотации C4 model для проектирования архитектуры программной системы
# Цель работы: Получить опыт использования графической нотации для фиксации архитектурных решений.

# Диаграмма системного контекста

<img width="477" height="699" alt="image" src="https://github.com/user-attachments/assets/2ad774f5-ec02-43cf-98d1-56c639d30c02" />
CRM Система: Центральный узел, который подвергается рефакторингу. Границы системы очерчены функционалом управления клиентами, задачами и финансами.

Пользователи: Менеджер (операционная деятельность) и Руководитель (аналитическая деятельность).
Внешние системы:
Почтовый сервис: Необходим для уведомлений о задачах или счетах.
Платежный шлюз: Упомянут в контексте финансовых операций (счета, история платежей).

# Диаграмма контейнеров

<img width="897" height="1248" alt="image" src="https://img.plantuml.biz/plantuml/png/ZLPTRnj557tthnZyqes8RRNmn5E34q55NIsnKH-jyNfghsAlLxjh8498JLeegD0KQ4K8nQKWn0CyECQklvBuByp-8ywTsMvs7QSG9SfwTkuzvvuvzuwl-m7tWcwxbNd3TgnMjovOCmXS_vr2mUEVv1jsqEpMkhxmh8uJ22V8MvrsmMrnXs9oVb1lsRL2yUsSIKiVbMuMsjmFX8UbQX4Ht7Q4btSfVoQmWvPWyIhRj7d3ussMOyNj4Yll8gxDZ4tR4rR0IjnksKw3lSa-u7TsEBlL2UmxjiK3k-FuQvcCAJo_unXjxl26yDPPLZwJ8tcAlw5yAKVXtIoj_IhxybYUXVluFmhtMRZ7v4pEvOJsgjKJEM7qEyRpKFR31tej2mZDgFfkf-lKkRThM5UHagZA5t8IxY5yXAtzx1hxBCFm4rTc-2x7rZBues0J1Dc6wxOYzaHiMt0hK0o_HvBZ70WH7T0ExsDX6kxb2MKUtWk_YgZV5hLonzeH0GFFUNZ0WFqF2ZwJ0rNuQVWm_8A5zzJ78PPFK2UzcCXf7kKGmoMQtBMht7L1OyEy0Mq8dyArU1jbCtzhguBzdb1KlqEgCKaSxkMG-mpm4wZPpxEhOFiBU2x0_q2UWFKZ1k9pHLmkb5hVa5PvTWrRduFbiJg56PxqkI3TCIhOnzw3IwfWSg3DiBgSpPfHhscUJuYlsV63XYVA7zvKxFz0RNrAH9I6wX6IoL7Q451pFM66F3DkUtOWMAbJ5wsrIu4jRZK5eQISWTJXjz1X0cWw9Wr_e0rGjtt5w-ZY5f0ou93wQr6D7P92rQjYPtHkMaYIykjNggcZT8cV5k-264lQH-wwv0YC2lTtDdpVRZYYlius1MyLcznfY7gQvXMohxRJX9fk75LsejqCZO3qc-p9d-NVyaZsu9B8wweXJo5UU5_LXLDPAjoXKL35IFhOjYBHpv5MywQYbPaBxBrELiSacqlF64AcMR5GwWn81-tW2vs64pAxVZEt2eqg8_xgpShMXb2Vn-DbwzF046rCkwgl5eZSSz1ue161DJrlJLH8xCkbYeaaYGmktsrZEbCEdM0E-v8DNogwKzMEuICvLiNtSDvtuz4uKs8JJpeaPOU16YPuM2ZWVlYbKX53CRCjMkTJLmywUOYW1NRFqULZtTA4ytwbOfOHH25gPthWA5EGrcUmmyCueB2zLQuG58N54Rgr_rGrgHOfo1yfNCyM2guKpS8DCuABu-BE_5-XcIiibyinkB8dVv27SEPZXalaCUpoGlwbbeze1_P58nE6NJtgb0cI4p7DQ_d8Uwjybqndq6M6Jv0AQ3YpjOGJKgcNlB0oSqhwL_ssR04QZcaBJ2xJw7TSP4_b4omzmukdk0qEvK-HKhWTr77Fa60ONyJdGuTW1Wnv-g206o5TJJpc4hU6PaDJAfbckdoKr_BfAOIUcYI-2YGPACm8wi9yILZdFn3VMaACffgwSvPc6W4k8UbkUirW8RZuUm0XNXTE7T-j_WK0" />

Описание основных элементов
API Server: Монолитное ядро системы. Обрабатывает бизнес-логику, напрямую взаимодействует с базой данных и отправляет E-mail рассылки через SMTP.
Notification Service: Выделенный сервис для работы с WebSocket. Обеспечивает мгновенные Push-уведомления пользователям, разгружая основной API от поддержки постоянных соединений.
Apache Kafka: Обеспечивает асинхронную передачу событий между API и сервисом уведомлений.
Redis: Используется как быстрый кэш для запросов чтения (реализация CQS).
PostgreSQL: Основное реляционное хранилище данных.

Выбрана структура с выделенным сервисом уведомлений, чтобы разделить нагрузку. API занимается тяжелыми транзакциями и почтой, а Notification Service держит тысячи легковесных WebSocket-соединений с клиентами.

# Диаграмма компонентов

<img width="1253" height="1603" alt="image" src="https://img.plantuml.biz/plantuml/png/hLTTRnjL47tthxZn2skH3m5zGWYrTOAeA2AD8_60aBMDDx3gUctMQsY4AjLsFvKgfL4bgeBIzeb773UBrtRj_eMx_uWpS_VRcpmW6jLnx9svPsREd9bxkUFgZjjjMgKFX7mHzEHxkP2pu8aS1mFfoNT2Ze9Uq0_kucDFpkKy60H7GfvA7_zdU5q4VNmn3GQYUgcqOjfxLhTXYC-gbpQgb-hLLhFTiWtR_RnKSatNCeHy3fkXV0k7G_aEFqCXf_3zZW-Uqnbmk90ZiIQkR5yJyetqyEo8NeNsZMssRF6XgDweuNLRFsZ2TwTIAbLRjgkRjk5edRQ-AigrxIj2lcI0xB6Cp-Gntf-koLCw6z6DoMUvajXktjGQD-d1Py0s9cHdU4Cn7mRtsSDhU9W5JuC753Xz0qTF1Pv_dlQZtTBtRn6Ah-Wt6pxZ14uv2YHvWP_Ju35dr9SJDWupfTajrzolTmo7xABe_Q0d01bf02RArYospRc7oGmrUWJaNj0N3458Nt2XtdFQHnG3Vmj7R-5cmOuvKEc9xMxdnxMYmoZKEQLbf1BfSwrmPd0F7qo2tZe2gHrqNADPtxhjQfscsoPqht3sGrLL7339r9JWVrVxUdVxUzY2WoihA-AZTQ89CfHWPI8IFH3OF3W21P55dvX9tu5y6awPeHhqzpySo4JWsLbm9CSPK6r5cleFloXevnaHi9hhc6r3R13JjdKBRwxgzYtY9MVzH549E2ctKsI66uKe0_QW9uWc4-Bt43dgKtOIajIljhfsGtSEDBrjCXIO-e2p01HLMs-f0-ImN16_bWJ-yKl2cZtuTLgMPJWTE6ExbqJHi7LdL4E0E2mhLj4nG4PyG94vZvphgD3b114XGPiYwNtnvUxkjk3Wo781kyDLAioGE-qCbdT97uXPlk1gZ_5_55hBFvbHFcTy4TobX1I4qZGQfkwscFyv2qNslFOWyThNRBHJAIihIlWZ1jF7SsC5J55UgGqLwImuP9oPUC2arzp-8_1khAhQutnvSbJ9G4vLi5stz8EePLF9pHGK_QDTQRSjSqzteMELk9RvKZQRkjteB54iU0X_KqASYe429ZdyrZ5T8yxFc7kbjuQ87l3XGmRZVqfqMk3hCqffy2IHTmyjEa0nJo34gYTyzG3fyXbUqMqayr46ifX_wXgEQLm4EPLa4e88zewXDnZrxvaYi5w4IGFcLpoK1kIDGR62zq9GGzKigpo_54_m-P680_6u09CqylYDKXm27UeWLOpKSidvMQn8FgRJjN3ur0pdPtFFA4Y9QRk6iw_lgQoyo6jbs8g_8LkzK3QKOFZbSvuNtAplkNn-52UnaaWCgF6auF6fNTjgwgOLublD0uwPVAU0puqMJEs4qi-PRj64c4GDCH7Q9Zzv7fD3FyrMmx2M_NZmWve-fiHpuLJaVwClGGEXLLkEeVevDSXNHLgpyTTnmbyvnE3u0sUyPT8DkRb9m4OX_OUiXuV550x1TbH-EiLuaoI7zIj0-oRi-N0vc2M0BigvQUyxUe6Aq92zf_XESKB5flWz82r7ZSceuphTFRTBnnUNmJ7QhRhPR5lH2fFda8_9jdcJHfDnswKOjhuG54yOpYAu7uwrQ2uHuU8EfRzJYr9nTWqYOmpYcFT8BXjxcBDUvjQ4TBRZdYXC1SPY59gQH10RwYLAVthjOI5IVKqR1HZZCOIne0sa63ZlSX7mQ9kAzcGMg3ulXK_-FuZSmQV8PP_tX-Azxm8r-xXmV-98isSVPMLZg6IFkuj68uJbt7Y2GK6kejsgkCnp5Ktgn2M9_kyvNDf5Sz6igzsbQfa0Y04Qxtd9HBjJkbCgxHYMka9a5wgThTfkRb605JsSUIwzkhnCxnaRsVaMsYQFfsV-1TlBabrgxbvi5cADJiahSxmKqECRl7RDepj2QaE0H5UAFQLbypYx3wQ09sOPJKf9J7GeuLVI6ssaoaCSSCR1Nzo6wiQJQ97qei1J3_CDhtRZkhfk02iLbJPSsdBKfEtpZ2UvJrqw-1a_S-tW6woV2omhT4itQWLmHfIDXIWCBMqPNPrE2Yvj6ebLPRcc6QMw-6I-87fyyIGVQSlexehjVn2ksTFGFADBNjfsLMHkhITyCjrO7gkY97UxJzPf0rMxjHy3obp3U5ukuWQLmroSUPLvmGJXrIdPyfFMnzqm9VJvDIYC8kipSqUarjyWyQZ55xytsUMGzfZa7ZMYOA_h1_NDt1wLcl2LqcN3RdIRrhy0" />
Описание диаграммы компонентов API Сервера
Точкой входа в приложение является Слой представления (API Controllers), который принимает REST-запросы от клиентов и выполняет первичную валидацию данных. Взаимодействие с бизнес-логикой происходит через Медиатор, который маршрутизирует вызовы к нужным обработчикам, обеспечивая слабую связность компонентов и скрывая детали реализации от контроллеров.
Слой приложения (Application Layer) реализует бизнес-сценарии, следуя принципу разделения ответственности (CQS). Обработчики команд (Command Handlers) управляют изменением состояния системы и координируют работу доменных объектов, в то время как обработчики запросов (Query Handlers) отвечают за быстрое чтение данных и формирование DTO. В этом же слое определены абстрактные интерфейсы для работы с внешними ресурсам, что обеспечивает инверсию зависимостей.
Центральным элементом архитектуры выступает Доменный слой (Domain Layer), содержащий чистую бизнес-логику, не зависящую от баз данных и фреймворков. Здесь находятся основные сущности (Клиент, Задача) и сущность Встречи, так как функционал календаря реализован внутри системы. Сложные правила, такие как проверка пересечения встреч в расписании, инкапсулированы в Доменных сервисах.
Техническая реализация взаимодействия с внешним миром вынесена в Слой инфраструктуры. Он включает в себя репозитории для доступа к базе данных через EF Core, реализацию сервиса для прямой отправки электронной почты по протоколу SMTP, а также компоненты для публикации событий в Kafka, необходимые для работы системы Push-уведомлений.

