# Тема: Использование нотации C4 model для проектирования архитектуры программной системы
# Цель работы: Получить опыт использования графической нотации для фиксации архитектурных решений.

# Диаграмма системного контекста

<img width="477" height="699" alt="image" src="https://github.com/user-attachments/assets/2ad774f5-ec02-43cf-98d1-56c639d30c02" />
CRM Система: Центральный узел, который подвергается рефакторингу. Границы системы очерчены функционалом управления клиентами, задачами и финансами.

Пользователи: Менеджер (операционная деятельность) и Руководитель (аналитическая деятельность).
Внешние системы:
Почтовый сервис: Необходим для уведомлений о задачах или счетах.
Платежный шлюз: Упомянут в контексте финансовых операций (счета, история платежей).

# Диаграмма контейнеров

<img width="897" height="1248" alt="image" src="https://img.plantuml.biz/plantuml/png/ZLPTRnj557tthnZyqes8RRNmn5E34q55NIsnKH-jyNfghsAlLxjh8498JLeegD0KQ4K8nQKWn0CyECQklvBuByp-8ywTsMvs7QSG9SfwTkuzvvuvzuwl-m7tWcwxbNd3TgnMjovOCmXS_vr2mUEVv1jsqEpMkhxmh8uJ22V8MvrsmMrnXs9oVb1lsRL2yUsSIKiVbMuMsjmFX8UbQX4Ht7Q4btSfVoQmWvPWyIhRj7d3ussMOyNj4Yll8gxDZ4tR4rR0IjnksKw3lSa-u7TsEBlL2UmxjiK3k-FuQvcCAJo_unXjxl26yDPPLZwJ8tcAlw5yAKVXtIoj_IhxybYUXVluFmhtMRZ7v4pEvOJsgjKJEM7qEyRpKFR31tej2mZDgFfkf-lKkRThM5UHagZA5t8IxY5yXAtzx1hxBCFm4rTc-2x7rZBues0J1Dc6wxOYzaHiMt0hK0o_HvBZ70WH7T0ExsDX6kxb2MKUtWk_YgZV5hLonzeH0GFFUNZ0WFqF2ZwJ0rNuQVWm_8A5zzJ78PPFK2UzcCXf7kKGmoMQtBMht7L1OyEy0Mq8dyArU1jbCtzhguBzdb1KlqEgCKaSxkMG-mpm4wZPpxEhOFiBU2x0_q2UWFKZ1k9pHLmkb5hVa5PvTWrRduFbiJg56PxqkI3TCIhOnzw3IwfWSg3DiBgSpPfHhscUJuYlsV63XYVA7zvKxFz0RNrAH9I6wX6IoL7Q451pFM66F3DkUtOWMAbJ5wsrIu4jRZK5eQISWTJXjz1X0cWw9Wr_e0rGjtt5w-ZY5f0ou93wQr6D7P92rQjYPtHkMaYIykjNggcZT8cV5k-264lQH-wwv0YC2lTtDdpVRZYYlius1MyLcznfY7gQvXMohxRJX9fk75LsejqCZO3qc-p9d-NVyaZsu9B8wweXJo5UU5_LXLDPAjoXKL35IFhOjYBHpv5MywQYbPaBxBrELiSacqlF64AcMR5GwWn81-tW2vs64pAxVZEt2eqg8_xgpShMXb2Vn-DbwzF046rCkwgl5eZSSz1ue161DJrlJLH8xCkbYeaaYGmktsrZEbCEdM0E-v8DNogwKzMEuICvLiNtSDvtuz4uKs8JJpeaPOU16YPuM2ZWVlYbKX53CRCjMkTJLmywUOYW1NRFqULZtTA4ytwbOfOHH25gPthWA5EGrcUmmyCueB2zLQuG58N54Rgr_rGrgHOfo1yfNCyM2guKpS8DCuABu-BE_5-XcIiibyinkB8dVv27SEPZXalaCUpoGlwbbeze1_P58nE6NJtgb0cI4p7DQ_d8Uwjybqndq6M6Jv0AQ3YpjOGJKgcNlB0oSqhwL_ssR04QZcaBJ2xJw7TSP4_b4omzmukdk0qEvK-HKhWTr77Fa60ONyJdGuTW1Wnv-g206o5TJJpc4hU6PaDJAfbckdoKr_BfAOIUcYI-2YGPACm8wi9yILZdFn3VMaACffgwSvPc6W4k8UbkUirW8RZuUm0XNXTE7T-j_WK0" />

Описание основных элементов
API Server: Монолитное ядро системы. Обрабатывает бизнес-логику, напрямую взаимодействует с базой данных и отправляет E-mail рассылки через SMTP.
Notification Service: Выделенный сервис для работы с WebSocket. Обеспечивает мгновенные Push-уведомления пользователям, разгружая основной API от поддержки постоянных соединений.
Apache Kafka: Обеспечивает асинхронную передачу событий между API и сервисом уведомлений.
Redis: Используется как быстрый кэш для запросов чтения (реализация CQS).
PostgreSQL: Основное реляционное хранилище данных.

Выбрана структура с выделенным сервисом уведомлений, чтобы разделить нагрузку. API занимается тяжелыми транзакциями и почтой, а Notification Service держит тысячи легковесных WebSocket-соединений с клиентами.

# Диаграмма компонентов

<img width="1253" height="1603" alt="image" src="https://img.plantuml.biz/plantuml/png/hLTBRzj64BxhLsnrAOdwSV6fA8guieiQJL35Cj13KGYqHAD495Abg2964S2IujY6ZRWn32HmMwSvzLXQDYjP3_elxFwZpimkAP9cV6gC-47jpCvyytqpmqTjpt2zJhDH-9JnTwBBxtZ89-A43qMV1tpA-41qHK_imUE0p_XCzCLhng_u2FvFu7ieUl31MFHPQOLfSCw73_2XpmFHmvC17p8uECE3yFaCdtD_6TnsnJ7u2FbOBtnYsRL6fswoBqehowMLQibfjXpRjBql2mNFyXecu-VWnEVNTCKKldp6ns0yfP1d61tu3Vc0BRBLyWRZ7-Yw0NvdsdUsvTZiCrPwMj4BXP9ZUuPbcwxMRXaBh5Wfhp9-GVcGco8yusVm-zKYly8B0OmXEYhgSzkrRQs-ZGVVG4133ES6Va68ZiK-UVWBF4p4gNY5EE4duEYKmVdpf1_jcR7p3AFu5d-IuHl2UqoXGqr2-BeIHrI04RybOmMFPZkUjLDjcoxQHIcFH9T1o90xn8GGJMBRZ7imcK193rMvA0Ie5gCItX7M0yn15dFAhy5DI8ufKHwmSgVzqsBUPPZg364PI21Z2eYNyE1MT9SWaSfkspERrVNddjPkUYsCxZtSVI1B2HVSfWg9uVzGUR9L_h6OB6FrAwTZrmrtLpDQ5la0Wn5nwr-LUN2F5DmlwkpN0eD_z6sEQGtykawZORfjS4Ps5rX0fOC9PWXf71SbvdWDX8be0GGe5ubQ14Dn7X560imLhm7DRxQsoWo9GvOXgc41mVA9XpTWkOTYGzn7ZB0Oml-1ikP_4DuW2OHAx26OEQaqpRfbU0wn8sCXgP0LCXHCUq96ctfHMlaGo245quDpGncO98GK8BB-HXnJdAbyc0OQG74CW453SWvqdb0l6UYfa1CLR5KRncv4w0IugO82kxJLLgjXrGmFfAt7jSoMijaqx3hMaLzABSl-90x0tnWZJkI02KE7OD-xbcV6-0ofPtKN8QDNTBbFmOm-Hpg5yF4DGYfEvhqo00BteHjseLmK_fYgYhOt1EU93gN-aw11Tn2BT83euGamZz19v_DpntGjyw5q4WL02KKfRPf6dJ9wcoeGAKq12lcyf-xVZmEYteT30JeAGOH2aggU8YROt22JIme0694Vj6LxfhjZr6JSxx9zG0dfDyX7mkV3FC6UEIf-v3mZgTqH-2F9PchT0wGWH1ftGPe7siPwqx0Q5TFznQgP2so3kbpPTUgTckd6D7oHGyQw0vRsd8_dn9Me-Tr6RBvbsXgT_1WDbP-cKpSRz_q4u0T0FyBUIkr39luFY0hgnBIIuvfIZ8aP1R2_ZTZ2VVZhR4u-535nymfcKKyMBKl1Kts9yT_Xp3KnnoVrOeSQA7xxrF2Eyqkg4cfBJDlvESthe4gSaz479Mer6oU9W3HyY5o5G37sQrbdI6Wg6qAe6Zdn_ev-3UZMW_a4IaZomKfRzevhv3GUd5elfGpG3pI-CVpiO_i7Og5HstCxDQ-32UKNtpLRJjLgjXhHJf0bxeWjixLjd6RcSmzHMV-Q8K8Ae53iaoXcyIX3biV2nRyJcmV0Dc2WH76m97U7Y0CvRUXKpw-kYNg9GYRnCAKUjW4FOrdc0WDpDKfKZZBeI2Xdh4Pogr1LGvNYeaaDP8-sHHpm-O7HgXG59fULICV_SsGPwFAtgJcXNXGAcsP3hfFfzM5plRAL6OjWXOTJvvA3-Y8vLPVJ7LlPpeyd9zm3i_gUNMAIF6ocOerkoRQoU0JYyMLQCcRHlfWG7_GqFTzJieUSfRUVo0lIOWgBLDP3Iba9eKJtOogo9KMhcFGGvvvoy3T9Khstn8hYGOH1uZ0j_fMdZ_4ZU74we_hYQXU2eHnIFUnyr0PngSCDub2jVqIk4Hq9gCxqQ4x_1tfEFmD0IgZttzza8XFaTomq1K7ICjgyBtDsVWt5gD-dGKg93zzCxnS1lRUWZwHbzEe3wt5VxQ5ZPPuIO92qNM2fbvvBkXadmL5Kl91HoT5-dqf2fP6ZDKVgkIylc7BXiR5RNSji0Ob9eHSUcNOTtfx_0m00" />
Описание диаграммы компонентов API Сервера
Точкой входа в приложение является Слой представления (API Controllers), который принимает REST-запросы от клиентов и выполняет первичную валидацию данных. Взаимодействие с бизнес-логикой происходит через Медиатор, который маршрутизирует вызовы к нужным обработчикам, обеспечивая слабую связность компонентов и скрывая детали реализации от контроллеров.
Слой приложения (Application Layer) реализует бизнес-сценарии, следуя принципу разделения ответственности (CQS). Обработчики команд (Command Handlers) управляют изменением состояния системы и координируют работу доменных объектов, в то время как обработчики запросов (Query Handlers) отвечают за быстрое чтение данных и формирование DTO. В этом же слое определены абстрактные интерфейсы для работы с внешними ресурсам, что обеспечивает инверсию зависимостей.
Центральным элементом архитектуры выступает Доменный слой (Domain Layer), содержащий чистую бизнес-логику, не зависящую от баз данных и фреймворков. Здесь находятся основные сущности (Клиент, Задача) и сущность Встречи, так как функционал календаря реализован внутри системы. Сложные правила, такие как проверка пересечения встреч в расписании, инкапсулированы в Доменных сервисах.
Техническая реализация взаимодействия с внешним миром вынесена в Слой инфраструктуры. Он включает в себя репозитории для доступа к базе данных через EF Core, реализацию сервиса для прямой отправки электронной почты по протоколу SMTP, а также компоненты для публикации событий в Kafka, необходимые для работы системы Push-уведомлений.
